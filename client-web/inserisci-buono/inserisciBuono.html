<!DOCTYPE html>
<html>
  <head>
    <title>Inserisci Bonus - Carta Cultura Giovani</title>
  </head>
  <body data-server-no-reload style="background-color: #1477bd;">
    <link rel="stylesheet" href="inserisciBuono.css">
    <div id="menuArea">
      <input type="checkbox" id="menuToggle"></input>
    
    <label for="menuToggle" class="menuOpen">
      <div class="open"></div>
    </label>
    
    <div class="menu menuEffects">
      <label for="menuToggle"></label>
      <div class="menuContent">
        <ul>
          <li><a href="../stato-globale-sistema/home.html">HOME</a></li>
          <li><a href="inserisciBuono.html">INSERISCI BUONO</a></li>
          <li><a href="../elenco-buoni-generati/elencoBuoni.html">ELENCO BUONI GENERATI</a></li>
          <li><a href="../index.html">ESCI</a></li>
        </ul>
      </div>
    </div>
    </div>

    <div class="content" style="color: white; font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;">
      <h1 class="ribbon">CARTA CULTURA GIOVANI</h1>
      <h1 style="font-family:'Franklin Gothic Medium', 
      'Arial Narrow', Arial, sans-serif; font-size:xx-large; display: flex; 
      justify-content: center; align-items: center; height: 10vh;">INSERISCI NUOVO BONUS</h1>
      <form method="post" id="voucherForm">
      </br>Inserisci importo: <textarea name="importo" id="importo" cols="30" rows="1">Inserisci importo (in euro)</textarea>
      </br>Inserisci tipologia del bene acquistato: <select name="cars" id="cars">
        <option value="cinema">Cinema</option>
        <option value="musica">Musica</option>
        <option value="concerti" selected>Concerti</option>
        <option value="eventiCulturali">Eventi culturali</option>
        <option value="libri">Libri</option>
        <option value="musei">Musei</option>
        <option value="strumentiMusicali">Strumenti Musicali</option>
        <option value="teatro">Teatro</option>
        <option value="danza">Danza</option>
      </select>
      </br><button type="submit">Invia</button>
      </form>
    </div>
  
    <script>

      window.onload = init();

      async function init() {
      document.getElementById('voucherForm').onsubmit = async function(e) {
        e.preventDefault();

        const importo = parseFloat(document.getElementById('importo').value);
        const tipologia = document.getElementById('tipologia').value;
        const fiscalCode = sessionStorage.getItem('sessionToken');

        if (isNaN(importo) || importo <= 0) {
          alert('Inserisci un importo valido!');
          return;
        }

        const voucher = {
          value: importo,
          type: tipologia
        };

        const res = await fetch(`http://localhost:8080/users/${fiscalCode}/vouchers`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(voucher)
        });

        if (!res.ok) {
          const errorText = await res.text();
          alert('Errore nella creazione del buono:\n' + errorText);
          return;
        }

        alert('Buono creato con successo!');
        window.location.href = '../elenco-buoni-generati/elencoBuoni.html';
      };
    }

    </script>
  </body>

</html>